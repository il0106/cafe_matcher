FROM node:20-alpine

WORKDIR /app

# Копируем package файлы
COPY package*.json ./

# Устанавливаем зависимости
RUN npm install

# Копируем исходный код
COPY . .

# Открываем порты
EXPOSE 5173 3333

# Устанавливаем зависимости при запуске (volume mount перезаписывает node_modules)
# Сначала устанавливаем зависимости, затем запускаем серверы
CMD sh -c "npm install; npm run dev & npm run dev:server & wait"

